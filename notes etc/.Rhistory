rename_pattern("^Grazing Footprint.*11$",       "Grazing_Footprint_Production")
rename_pattern("^Forest Product Footprint.*12$","Forest_Footprint_Production")
rename_pattern("^Fish Footprint.*13$",          "Fish_Footprint_Production")
rename_pattern("^Built up land.*14$",           "BuiltUp_Footprint_Production")
rename_pattern("^Carbon Footprint.*15$",        "Carbon_Footprint_Production")
rename_pattern("^Cropland Footprint.*17$",      "Cropland_Footprint_Consumption")
rename_pattern("^Grazing Footprint.*18$",       "Grazing_Footprint_Consumption")
rename_pattern("^Forest Product Footprint.*19$","Forest_Footprint_Consumption")
rename_pattern("^Fish Footprint.*20$",          "Fish_Footprint_Consumption")
rename_pattern("^Built up land.*21$",           "BuiltUp_Footprint_Consumption")
rename_pattern("^Carbon Footprint.*22$",        "Carbon_Footprint_Consumption")
rename_pattern("^Built up land.*28$",           "BuiltUp_Biocapacity")
names(df)[names(df) == "Total_Footprint_Production"] <- "Total_Footprint_Production"
names(df)[names(df) == "Total_Footprint_Consumption"] <- "Total_Footprint_Consumption"
names(df)[names(df) == "Total_Biocapacity"] <- "Total_Biocapacity"
force_text <- c("Country", "Region", "Income Group", "Overshoot Day", "Quality Score")
clean_numeric <- function(x) {
if (!is.character(x)) return(x)
x <- str_replace_all(x, "[\u202f,$% ]", "")
suppressWarnings(as.numeric(x))
}
for (col in names(df)) {
if (!(col %in% force_text)) {
df[[col]] <- clean_numeric(df[[col]])
}
}
return(df)
}
setwd("~/ProjetTutore")
getwd()
df <- load_mydf()
names(df)
overshoot_to_doy <- function(x) {
dt <- suppressWarnings(as.Date(x, format = "%B %d, %Y"))
ifelse(is.na(dt), NA, yday(dt))
}
df$Overshoot_Day_DOY <- overshoot_to_doy(df$`Overshoot Day`)
df_supervised <- df %>% filter(!is.na(Overshoot_Day_DOY)) %>% drop_na()
df_supervised$`Income Group` <- factor(
df_supervised$`Income Group`,
levels = c("LI", "LM", "UM", "HI")
)
X <- df_supervised_encoded %>% select(-all_of(drop_cols), -Overshoot_Day_DOY)
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(lubridate)
library(tidyr)
load_mydf <- function() {
df <- read_excel("data/toutlespays.xlsx")
names(df) <- names(df) |>
str_replace("\r\n", " ") |>
str_replace("\n", " ") |>
str_squish()
names(df)[str_detect(names(df), "Overshoot Day")] <- "Overshoot Day"
rename_pattern <- function(pattern, newname) {
idx <- str_detect(names(df), pattern)
names(df)[idx] <<- newname
}
rename_pattern("^Cropland Footprint.*10$",      "Cropland_Footprint_Production")
rename_pattern("^Grazing Footprint.*11$",       "Grazing_Footprint_Production")
rename_pattern("^Forest Product Footprint.*12$","Forest_Footprint_Production")
rename_pattern("^Fish Footprint.*13$",          "Fish_Footprint_Production")
rename_pattern("^Built up land.*14$",           "BuiltUp_Footprint_Production")
rename_pattern("^Carbon Footprint.*15$",        "Carbon_Footprint_Production")
rename_pattern("^Cropland Footprint.*17$",      "Cropland_Footprint_Consumption")
rename_pattern("^Grazing Footprint.*18$",       "Grazing_Footprint_Consumption")
rename_pattern("^Forest Product Footprint.*19$","Forest_Footprint_Consumption")
rename_pattern("^Fish Footprint.*20$",          "Fish_Footprint_Consumption")
rename_pattern("^Built up land.*21$",           "BuiltUp_Footprint_Consumption")
rename_pattern("^Carbon Footprint.*22$",        "Carbon_Footprint_Consumption")
rename_pattern("^Built up land.*28$",           "BuiltUp_Biocapacity")
names(df)[names(df) == "Total_Footprint_Production"] <- "Total_Footprint_Production"
names(df)[names(df) == "Total_Footprint_Consumption"] <- "Total_Footprint_Consumption"
names(df)[names(df) == "Total_Biocapacity"] <- "Total_Biocapacity"
force_text <- c("Country", "Region", "Income Group", "Overshoot Day", "Quality Score")
clean_numeric <- function(x) {
if (!is.character(x)) return(x)
x <- str_replace_all(x, "[\u202f,$% ]", "")
suppressWarnings(as.numeric(x))
}
for (col in names(df)) {
if (!(col %in% force_text)) {
df[[col]] <- clean_numeric(df[[col]])
}
}
return(df)
}
setwd("~/ProjetTutore")
getwd()
df <- load_mydf()
names(df)
overshoot_to_doy <- function(x) {
dt <- suppressWarnings(as.Date(x, format = "%B %d, %Y"))
ifelse(is.na(dt), NA, yday(dt))
}
df$Overshoot_Day_DOY <- overshoot_to_doy(df$`Overshoot Day`)
df_supervised <- df %>% filter(!is.na(Overshoot_Day_DOY)) %>% drop_na()
df_supervised$`Income Group` <- factor(
df_supervised$`Income Group`,
levels = c("LI", "LM", "UM", "HI")
)
X <- df_supervised %>% select(-all_of(drop_cols), -Overshoot_Day_DOY)
library(readxl)
library(dplyr)
library(stringr)
library(lubridate)
library(tidyr)
library(caret)
df <- load_mydf()
df$Overshoot_Day_DOY <- suppressWarnings(
as.Date(df$`Overshoot Day`, format = "%B %d, %Y")
) |> yday()
df_supervised <- df %>%
filter(!is.na(Overshoot_Day_DOY)) %>%
drop_na()
df_supervised$`Income Group` <- factor(
df_supervised$`Income Group`,
levels = c("LI", "LM", "UM", "HI")
)
drop_cols <- c("Country", "Region", "Overshoot Day", "Quality Score")
df_supervised <- df_supervised %>% select(-all_of(drop_cols))
set.seed(123)
train_index <- createDataPartition(
df_supervised$Overshoot_Day_DOY,
p = 0.8,
list = FALSE
)
train_df <- df_supervised[train_index, ]
test_df  <- df_supervised[-train_index, ]
full_model <- lm(y_train ~ ., data = X_train)
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(lubridate)
library(tidyr)
load_mydf <- function() {
df <- read_excel("data/toutlespays.xlsx")
names(df) <- names(df) |>
str_replace("\r\n", " ") |>
str_replace("\n", " ") |>
str_squish()
names(df)[str_detect(names(df), "Overshoot Day")] <- "Overshoot Day"
rename_pattern <- function(pattern, newname) {
idx <- str_detect(names(df), pattern)
names(df)[idx] <<- newname
}
rename_pattern("^Cropland Footprint.*10$",      "Cropland_Footprint_Production")
rename_pattern("^Grazing Footprint.*11$",       "Grazing_Footprint_Production")
rename_pattern("^Forest Product Footprint.*12$","Forest_Footprint_Production")
rename_pattern("^Fish Footprint.*13$",          "Fish_Footprint_Production")
rename_pattern("^Built up land.*14$",           "BuiltUp_Footprint_Production")
rename_pattern("^Carbon Footprint.*15$",        "Carbon_Footprint_Production")
rename_pattern("^Cropland Footprint.*17$",      "Cropland_Footprint_Consumption")
rename_pattern("^Grazing Footprint.*18$",       "Grazing_Footprint_Consumption")
rename_pattern("^Forest Product Footprint.*19$","Forest_Footprint_Consumption")
rename_pattern("^Fish Footprint.*20$",          "Fish_Footprint_Consumption")
rename_pattern("^Built up land.*21$",           "BuiltUp_Footprint_Consumption")
rename_pattern("^Carbon Footprint.*22$",        "Carbon_Footprint_Consumption")
rename_pattern("^Built up land.*28$",           "BuiltUp_Biocapacity")
names(df)[names(df) == "Total_Footprint_Production"] <- "Total_Footprint_Production"
names(df)[names(df) == "Total_Footprint_Consumption"] <- "Total_Footprint_Consumption"
names(df)[names(df) == "Total_Biocapacity"] <- "Total_Biocapacity"
force_text <- c("Country", "Region", "Income Group", "Overshoot Day", "Quality Score")
clean_numeric <- function(x) {
if (!is.character(x)) return(x)
x <- str_replace_all(x, "[\u202f,$% ]", "")
suppressWarnings(as.numeric(x))
}
for (col in names(df)) {
if (!(col %in% force_text)) {
df[[col]] <- clean_numeric(df[[col]])
}
}
return(df)
}
setwd("~/ProjetTutore")
getwd()
df <- load_mydf()
names(df)
library(readxl)
library(dplyr)
library(stringr)
library(lubridate)
library(tidyr)
library(caret)
df <- load_mydf()
df$Overshoot_Day_DOY <- suppressWarnings(
as.Date(df$`Overshoot Day`, format = "%B %d, %Y")
) |> yday()
df_supervised <- df %>%
filter(!is.na(Overshoot_Day_DOY)) %>%
drop_na()
df_supervised$`Income Group` <- factor(
df_supervised$`Income Group`,
levels = c("LI", "LM", "UM", "HI")
)
drop_cols <- c("Country", "Region", "Overshoot Day", "Quality Score")
df_supervised <- df_supervised %>% select(-all_of(drop_cols))
set.seed(123)
train_index <- createDataPartition(
df_supervised$Overshoot_Day_DOY,
p = 0.8,
list = FALSE
)
train_df <- df_supervised[train_index, ]
test_df  <- df_supervised[-train_index, ]
full_model <- lm(Overshoot_Day_DOY ~ ., data = train_df)
summary(full_model)
alias(full_model)
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(lubridate)
library(fastDummies)
library(caret)
library(tidyr)
load_mydf <- function() {
df <- read_excel("data/toutlespays.xlsx")
names(df) <- names(df) |>
str_replace("\r\n", " ") |>
str_replace("\n", " ") |>
str_squish()
names(df)[str_detect(names(df), "Overshoot Day")] <- "Overshoot Day"
rename_pattern <- function(pattern, newname) {
idx <- str_detect(names(df), pattern)
names(df)[idx] <<- newname
}
rename_pattern("^Cropland Footprint.*10$",      "Cropland_Footprint_Production")
rename_pattern("^Grazing Footprint.*11$",       "Grazing_Footprint_Production")
rename_pattern("^Forest Product Footprint.*12$","Forest_Footprint_Production")
rename_pattern("^Fish Footprint.*13$",          "Fish_Footprint_Production")
rename_pattern("^Built up land.*14$",           "BuiltUp_Footprint_Production")
rename_pattern("^Carbon Footprint.*15$",        "Carbon_Footprint_Production")
rename_pattern("^Cropland Footprint.*17$",      "Cropland_Footprint_Consumption")
rename_pattern("^Grazing Footprint.*18$",       "Grazing_Footprint_Consumption")
rename_pattern("^Forest Product Footprint.*19$","Forest_Footprint_Consumption")
rename_pattern("^Fish Footprint.*20$",          "Fish_Footprint_Consumption")
rename_pattern("^Built up land.*21$",           "BuiltUp_Footprint_Consumption")
rename_pattern("^Carbon Footprint.*22$",        "Carbon_Footprint_Consumption")
rename_pattern("^Built up land.*28$",           "BuiltUp_Biocapacity")
names(df)[names(df) == "Total_Footprint_Production"] <- "Total_Footprint_Production"
names(df)[names(df) == "Total_Footprint_Consumption"] <- "Total_Footprint_Consumption"
names(df)[names(df) == "Total_Biocapacity"] <- "Total_Biocapacity"
force_text <- c("Country", "Region", "Income Group", "Overshoot Day", "Quality Score")
clean_numeric <- function(x) {
if (!is.character(x)) return(x)
x <- str_replace_all(x, "[\u202f,$% ]", "")
suppressWarnings(as.numeric(x))
}
for (col in names(df)) {
if (!(col %in% force_text)) {
df[[col]] <- clean_numeric(df[[col]])
}
}
return(df)
}
setwd("~/ProjetTutore")
getwd()
df <- load_mydf()
names(df)
overshoot_to_doy <- function(x) {
dt <- suppressWarnings(as.Date(x, format = "%B %d, %Y"))
ifelse(is.na(dt), NA, yday(dt))
}
df$Overshoot_Day_DOY <- overshoot_to_doy(df$`Overshoot Day`)
df_supervised <- df %>% filter(!is.na(Overshoot_Day_DOY)) %>% drop_na()
df_supervised_encoded <- fastDummies::dummy_cols(
df_supervised,
select_columns = "Income Group",
remove_first_dummy = TRUE,
remove_selected_columns = TRUE
)
drop_cols <- c("Country", "Region", "Overshoot Day", "Quality Score")
X <- df_supervised_encoded %>% select(-all_of(drop_cols), -Overshoot_Day_DOY)
y <- df_supervised_encoded$Overshoot_Day_DOY
library(caret)
library(FactoMineR)
library(pls)
library(factoextra)
set.seed(123)
train_index <- createDataPartition(y, p = 0.8, list = FALSE)
test_index  <- setdiff(seq_len(nrow(X)), train_index)
num_cols <- sapply(X, is.numeric)
X_num <- X[, num_cols, drop = FALSE]
X_train_num <- X_num[train_index, , drop = FALSE]
X_test_num  <- X_num[test_index,  , drop = FALSE]
y_train <- y[train_index]
y_test  <- y[test_index]
metrics <- function(y_true, y_pred) {
MAE  <- mean(abs(y_true - y_pred))
RMSE <- sqrt(mean((y_true - y_pred)^2))
R2   <- 1 - sum((y_true - y_pred)^2) / sum((y_true - mean(y_true))^2)
c(MAE = MAE, RMSE = RMSE, R2 = R2)
}
set.seed(123)
pcr_cv <- pcr(
y_train ~ .,
data = data.frame(y_train = y_train, X_train_num),
scale = TRUE,
validation = "CV"
)
rmse_cv <- RMSEP(pcr_cv)$val[1, 1, -1]
k_best <- which.min(rmse_cv)
pred_test <- as.vector(predict(pcr_cv, newdata = data.frame(X_test_num), ncomp = k_best))
cat("\n--- PCR (pls::pcr) with CV-selected k ---\n")
cat("k_best =", k_best, "out of", ncol(X_train_num), "max PCs\n")
print(metrics(y_test, pred_test))
X_all <- rbind(X_train_num, X_test_num)
ind_sup <- (nrow(X_train_num) + 1):nrow(X_all)
res_pca <- PCA(
X_all,
ind.sup = ind_sup,
scale.unit = TRUE,
ncp = min(ncol(X_train_num), nrow(X_train_num) - 1),
graph = FALSE
)
k_lm <- k_best
Z_train_lm <- res_pca$ind$coord[, 1:k_lm, drop = FALSE]
Z_test_lm  <- res_pca$ind.sup$coord[, 1:k_lm, drop = FALSE]
lm_pc <- lm(y_train ~ ., data = as.data.frame(Z_train_lm))
summary(lm_pc)
pred_lm <- predict(lm_pc, newdata = as.data.frame(Z_test_lm))
cat("\n--- lm() on PCs ---\n")
cat("k_lm =", k_lm, "\n")
print(metrics(y_test, pred_lm))
fviz_eig(res_pca, addlabels = TRUE)
fviz_pca_var(res_pca, col.var = "cos2", repel = TRUE)
fviz_pca_ind(res_pca, repel = TRUE)
fviz_pca_biplot(res_pca, repel = TRUE)
fviz_contrib(res_pca, choice = "var", axes = 1, top = 10)
fviz_contrib(res_pca, choice = "var", axes = 2, top = 10)
cat("\n--- Top contributors to PC1 (FactoMineR) ---\n")
print(head(sort(res_pca$var$contrib[,1], decreasing = TRUE), 10))
cat("\n--- Top contributors to PC2 (FactoMineR) ---\n")
print(head(sort(res_pca$var$contrib[,2], decreasing = TRUE), 10))
coef_arr <- coef(pcr_cv, ncomp = k_best, intercept = TRUE)  # matrix/array
coef_vec <- as.vector(coef_arr)
names(coef_vec) <- rownames(coef_arr)
-coef_vec <- coef_vec[names(coef_vec) != "(Intercept)"]
modele0 <- lm(y_train ~ SDGi + `Life Expectancy`  + HDI+ `Per Capita GDP` + `Population (millions)` + Cropland_Footprint_Production +
Grazing_Footprint_Production +
Forest_Footprint_Production +
Fish_Footprint_Production +
BuiltUp_Footprint_Production+ Cropland_Footprint_Consumption +
Grazing_Footprint_Consumption +
Forest_Footprint_Consumption +
Fish_Footprint_Consumption +
BuiltUp_Footprint_Consumption + Cropland  +
`Grazing land` +
`Forest land` +
`Fishing ground` +
BuiltUp_Biocapacity +  `Ecological (Deficit) or Reserve`
+ `Number of Earths required` +
`Number of Countries required`+
`Income Group_LM` + `Income Group_LI` +
`Income Group_UM`, data = X_train )
set.seed(123)
train_index <- createDataPartition(y, p = 0.8, list = FALSE)
X_train <- X[train_index, , drop = FALSE]
X_test  <- X[-train_index, , drop = FALSE]
y_train <- y[train_index]
y_test  <- y[-train_index]
full_model <- lm(y_train ~ ., data = X_train)
summary(full_model)
modele0 <- lm(y_train ~ SDGi + `Life Expectancy`  + HDI+ `Per Capita GDP` + `Population (millions)` + Cropland_Footprint_Production +
Grazing_Footprint_Production +
Forest_Footprint_Production +
Fish_Footprint_Production +
BuiltUp_Footprint_Production+ Cropland_Footprint_Consumption +
Grazing_Footprint_Consumption +
Forest_Footprint_Consumption +
Fish_Footprint_Consumption +
BuiltUp_Footprint_Consumption + Cropland  +
`Grazing land` +
`Forest land` +
`Fishing ground` +
BuiltUp_Biocapacity +  `Ecological (Deficit) or Reserve`
+ `Number of Earths required` +
`Number of Countries required`+
`Income Group_LM` + `Income Group_LI` +
`Income Group_UM`, data = X_train )
summary(modele0)
alias(full_model)
alias(modele0)
modele1 <- lm(y_train ~ SDGi + `Life Expectancy`  + HDI+ `Per Capita GDP` + `Population (millions)` + Cropland_Footprint_Production +
Grazing_Footprint_Production +
Forest_Footprint_Production +
Fish_Footprint_Production +
BuiltUp_Footprint_Production+ Cropland_Footprint_Consumption +
Grazing_Footprint_Consumption +
Forest_Footprint_Consumption +
Fish_Footprint_Consumption  +
`Grazing land` +
`Forest land` +
`Fishing ground` +  `Ecological (Deficit) or Reserve`  +
`Number of Countries required` +
factor(Income Group, ref = "LI"), data = X_train )
modele_totals <- lm(
Overshoot_Day_DOY ~
SDGi +
`Life Expectancy` +
HDI +
`Per Capita GDP` +
`Population (millions)` +
`Income Group` +
`Total Ecological Footprint (Production)` +
`Total Ecological Footprint (Consumption)` +
`Total biocapacity` +
`Number of Countries required`,
data = train_df
)
summary(modele_totals)
alias(modele_totals)
modele_totals <- lm(
Overshoot_Day_DOY ~
SDGi +
`Life Expectancy` +
HDI +
`Per Capita GDP` +
`Population (millions)` +
`Income Group` +
`Total Ecological Footprint (Production)` +
`Total Ecological Footprint (Consumption)` +
`Total biocapacity` +
`Number of Countries required`,
data = train_df
)
summary(modele_totals)
modele_components <- lm(
Overshoot_Day_DOY ~
SDGi +
`Life Expectancy` +
HDI +
`Per Capita GDP` +
`Population (millions)` +
`Income Group` +
# Production
Cropland_Footprint_Production +
Grazing_Footprint_Production +
Forest_Footprint_Production +
Fish_Footprint_Production +
BuiltUp_Footprint_Production +
Carbon_Footprint_Production +
# Consumption
Cropland_Footprint_Consumption +
Grazing_Footprint_Consumption +
Forest_Footprint_Consumption +
Fish_Footprint_Consumption +
Carbon_Footprint_Consumption +
# Biocapacity
Cropland +
`Grazing land` +
`Forest land` +
`Fishing ground` +
BuiltUp_Biocapacity +
# Pressure
`Number of Countries required`,
data = train_df
)
summary(modele_components)
alias(modele_components)
modele_components <- lm(
Overshoot_Day_DOY ~
SDGi +
`Life Expectancy` +
HDI +
`Per Capita GDP` +
`Population (millions)` +
`Income Group` +
# Production
Cropland_Footprint_Production +
Grazing_Footprint_Production +
Forest_Footprint_Production +
Fish_Footprint_Production +
BuiltUp_Footprint_Production +
Carbon_Footprint_Production +
# Consumption
Cropland_Footprint_Consumption +
Grazing_Footprint_Consumption +
Forest_Footprint_Consumption +
Fish_Footprint_Consumption +
Carbon_Footprint_Consumption +
# Biocapacity
`Grazing land` +
`Forest land` +
`Fishing ground` +
# Pressure
`Number of Countries required`,
data = train_df
)
summary(modele_components)
alias(modele_components)
step(modele_components, method="both")
modelecompstep <- lm(formula = Overshoot_Day_DOY ~ SDGi + `Life Expectancy` + HDI +
`Per Capita GDP` + `Population (millions)` + `Income Group` +
BuiltUp_Footprint_Production + Cropland_Footprint_Consumption +
Grazing_Footprint_Consumption + Forest_Footprint_Consumption +
Fish_Footprint_Consumption + Carbon_Footprint_Consumption +
`Forest land`, data = train_df)
summary(modelecompstep)
step(modele_totals, method="both")
modeletotalstep <- lm(formula = Overshoot_Day_DOY ~ SDGi + `Life Expectancy` + HDI +
`Per Capita GDP` + `Total Ecological Footprint (Consumption)` +
`Total biocapacity`, data = train_df)
summary(modeletotalstep)
full_model <- lm(Overshoot_Day_DOY ~ ., data = train_df)
summary(full_model)
alias(full_model)
